const t=document.querySelector(".button"),e=document.querySelector(".message-start"),s=document.querySelector(".message-lose"),a=document.querySelector(".message-win"),i=document.querySelector(".game-score");var r={};class l{static gameStatus={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.score=0,this.gameStatus=l.gameStatus.idle,this.state=t.map(t=>[...t])}isStateChanged(t){this.hasStateChanged(t,this.state)&&(this.addRandomTile(),this.updateStatusOfTheGame(this.state))}addRandomTile(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push([e,s]);if(t.length>0){let[e,s]=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}}slideAndMerge(t){let e=t.filter(t=>0!==t),s=[];for(let t=0;t<e.length;t++)e[t]===e[t+1]?(s.push(2*e[t]),this.score+=2*e[t],t++):s.push(e[t]);return s.concat(Array(4-s.length).fill(0))}hasStateChanged(t,e){for(let s=0;s<4;s++)for(let a=0;a<4;a++)if(t[s][a]!==e[s][a])return!0;return!1}moveUp(){if(this.gameStatus!==l.gameStatus.playing)return;let t=this.state.map(t=>[...t]);for(let t=0;t<4;t++){let e=this.state.map(e=>e[t]),s=this.slideAndMerge(e);for(let e=0;e<4;e++)this.state[e][t]=s[e]}this.isStateChanged(t)}moveDown(){if(this.gameStatus!==l.gameStatus.playing)return;let t=this.state.map(t=>[...t]);for(let t=0;t<4;t++){let e=this.state.map(e=>e[t]).reverse(),s=this.slideAndMerge(e).reverse();for(let e=0;e<4;e++)this.state[e][t]=s[e]}this.isStateChanged(t)}moveLeft(){if(this.gameStatus!==l.gameStatus.playing)return;let t=this.state.map(t=>[...t]);for(let t=0;t<4;t++)this.state[t]=this.slideAndMerge(this.state[t]);this.isStateChanged(t)}moveRight(){if(this.gameStatus!==l.gameStatus.playing)return;let t=this.state.map(t=>[...t]);for(let t=0;t<4;t++)this.state[t]=this.slideAndMerge(this.state[t].reverse()).reverse();this.isStateChanged(t)}updateStatusOfTheGame(t){let e=!1;t.forEach(t=>{t.forEach(t=>{2048===t&&(e=!0)})}),e?this.gameStatus=l.gameStatus.win:this.canMove()||(this.gameStatus=l.gameStatus.lose)}getScore(){return this.score}getState(){return this.state}getStatus(){return this.gameStatus}start(){this.gameStatus===l.gameStatus.idle&&(this.gameStatus=l.gameStatus.playing,this.addRandomTile(),this.addRandomTile())}restart(){this.score=0,this.gameStatus=l.gameStatus.idle,this.state=this.initialState.map(t=>[...t])}canMove(){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.state[t][e];if(0===this.state[t][e]||e<3&&s===this.state[t][e+1]||t<3&&s===this.state[t+1][e])return!0}return!1}}const n=new(r=l);function o(){let t=n.getState();document.querySelectorAll(".field-row").forEach((e,s)=>{e.querySelectorAll(".field-cell").forEach((e,a)=>{let i=t[s][a];e.setAttribute("class","field-cell"),e.textContent="",0!==i&&(e.classList.add(`field-cell--${i}`),e.textContent=i)})}),i.textContent=n.getScore(),u()}function h(){window.addEventListener("keydown",d,{once:!0})}function d(t){if(n.getStatus()===r.gameStatus.playing){switch(t.key){case"ArrowUp":n.moveUp();break;case"ArrowDown":n.moveDown();break;case"ArrowLeft":n.moveLeft();break;case"ArrowRight":n.moveRight()}h(),o(),u()}}function u(){s.classList.add("hidden"),a.classList.add("hidden"),e.classList.add("hidden"),n.gameStatus===r.gameStatus.win?a.classList.remove("hidden"):n.gameStatus===r.gameStatus.lose&&s.classList.remove("hidden")}t.addEventListener("click",function(){h(),n.gameStatus===r.gameStatus.idle?(n.start(),t.textContent="Restart",t.classList.replace("start","restart")):(n.restart(),t.textContent="Start",t.classList.replace("restart","start")),o()});
//# sourceMappingURL=index.69e3cdc4.js.map
